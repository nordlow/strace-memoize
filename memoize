#!/usr/bin/env python3

import sys
import os
import subprocess
import os.path
import re
import hashlib
import tempfile
import pickle                   # cPickle not available in Python3

import json

from pprint import pprint as pp
from getopt import getopt

from dbgio import dln

# if set use modification time instead of content-hash as indentity
OPT_USE_MODTIME = False

SYS_CALLS = ["open", "openat", "stat", "stat64", "statfs", "access"]
SYS_CALLS_AT = ["openat"]       # Linux

# content hashing algorithm
HASH_NAME = 'sha1'

RELEVANT_DIRS = ['.']

STRACE_FLAGS = ['-f']


def memoizedRun(args):

    strace_args = ['strace'] + STRACE_FLAGS + args

    # https://docs.python.org/3.6/library/subprocess.html#subprocess.run
    return subprocess.run(strace_args)

    print("args:", args)


if __name__ == '__main__':

    (opts, args) = getopt(sys.argv[1:], 'td:')

    for (opt, value) in opts:
        if opt == '-t':
            OPT_USE_MODTIME = True
        elif opt == '-d':
            RELEVANT_DIRS.append(value)

    status = memoizedRun(args)
    print(type(status))
    sys.exit(status)
